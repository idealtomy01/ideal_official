# AIエージェント利用規約 (AI_POLICY.md)

このプロジェクトでAIエージェント（Cursor, Copilot, ChatGPTなど）を利用する際は、以下の原則を厳守すること。
AIは「自律的な作業者」ではなく、「開発者の指示に従うアシスタント」である。

---

## 1. 原則: 変更は最小限かつ指示通りに

**原則として、依頼内容に関わる箇所以外は、1行たりとも修正や変更を行わないこと。**

- **NG:** コードのリファクタリング（整理）を依頼したら、依頼箇所以外のフォーマットや変数名も勝手に修正した。
- **OK:** 依頼された箇所のロジックのみを修正する。

## 2. UI（見た目）に関する禁止事項

**UI（HTML構造やTailwind CSSのクラス）の変更は、開発者からの明示的な「依頼があったときのみ」行うこと。**

- **NG:** ロジック修正のついでに、ボタンの色や余白を「こっちの方が良いだろう」と判断して変更する。
- **OK:** 「このボタンを青くして」という指示に従い、`className` のみを変更する。

## 3. GitHub操作に関する禁止事項

**Git操作（コミット、プッシュ）やビルドチェックは、開発者からの明示的な「指示があったときのみ」行うこと。**

- **NG:** 修正が完了したとAIが判断し、勝手に `git commit` を実行する。
- **NG:** 修正するたびに、毎回自動で `npm run build` を実行してチェックする。
- **OK:** 「この修正をコミットして」という指示に従い、`git commit` を実行する。

## 4. 参照ドキュメントの優先順位

**提案や修正を行う際は、必ず以下のドキュメントを「最優先」の憲法として参照すること。**

1.  `docs/concept.md`（開発原則）
2.  `docs/design.md`（デザインルール）
3.  `docs/DEVELOPMENT_GUIDE.md`（開発ガイド・公式サイトリンク）

---

## 5. ファイル構造の変更ルール

**新しいファイルやディレクトリの作成、既存の構造変更は、開発者の明示的な指示があったときのみ行うこと。**

- **NG:** コンポーネントが増えてきたので、勝手に `components/common/` フォルダを作成して整理する。
- **OK:** 「コンポーネントを `components/ui/` フォルダに整理して」という指示に従い、ファイルを移動する。

### 推奨ファイル構造（Next.js App Router）

```
app/
├── (routes)/           # ルートグループ（URLに影響しない）
│   ├── page.tsx       # トップページ
│   └── about/
│       └── page.tsx   # /about ページ
├── components/        # 共通コンポーネント
│   ├── ui/           # 再利用可能なUIパーツ（Button, Card など）
│   ├── layout/       # レイアウト関連（Header, Footer など）
│   └── feature/      # 機能別コンポーネント（Carousel, Form など）
├── lib/              # ユーティリティ関数、API クライアント
├── types/            # TypeScript 型定義
└── layout.tsx        # ルートレイアウト
```

---

## 6. 依存関係（パッケージ）の追加ルール

**新しいパッケージのインストールは、開発者の承認を得てから行うこと。**

### パッケージ追加時の確認事項

1. **必要性の確認:**
   - 「このパッケージは本当に必要か？」
   - 「既存のパッケージや標準機能で代替できないか？」
2. **バージョン互換性:**
   - Next.js のバージョンと互換性があるか確認する。
   - `peerDependencies` の警告が出ないか確認する。
3. **メンテナンス状況:**
   - npm のダウンロード数、最終更新日、GitHub のスター数を確認する。
   - 放置されたパッケージは避ける。
4. **バンドルサイズ:**
   - パフォーマンスに影響する大きなパッケージは避ける。
   - [Bundlephobia](https://bundlephobia.com/) で事前確認を推奨。

### 提案フォーマット

```
パッケージ名: framer-motion
用途: スクロールアニメーション
理由: 宣言的で Next.js と相性が良く、バンドルサイズも最適化されている
代替案: CSS アニメーションのみ（機能が限定的）
```

---

## 7. エラーハンドリングの原則

**エラーが発生した場合、以下の手順で対応すること。**

### A. エラーの報告（必須）

1. **エラーメッセージの全文を開発者に報告する。**
2. **エラーが発生した箇所（ファイル名、行番号）を明示する。**
3. **推測ではなく、公式ドキュメントに基づいた解決策を提案する。**

### B. 自動修正の禁止

- **NG:** エラーを見つけたので、原因を推測して勝手に修正した。
- **OK:** 「このエラーは Next.js の公式ドキュメントによると、〇〇が原因です。△△に修正しますか？」と確認する。

### C. 試行錯誤の禁止

- **NG:** 1つ目の解決策が失敗したので、2つ目、3つ目と自動で試していく。
- **OK:** 1つ目の解決策を提案し、失敗した場合は開発者に報告してから次の手を相談する。

---

## 8. テストコードの扱い

**テストコード（`*.test.ts`, `*.spec.ts`）の作成・修正は、開発者の明示的な指示があったときのみ行うこと。**

- **原則:** 本番コードの修正が最優先。テストは後回しにする（ただし、TDD を採用する場合は例外）。
- **NG:** コンポーネントを修正したので、ついでにテストも追加しておいた。
- **OK:** 「このコンポーネントのテストを追加して」という指示に従い、テストファイルを作成する。

---

## 9. ログ出力・デバッグコードの扱い

**`console.log()` などのデバッグコードは、開発者の指示がない限り追加しないこと。**

- **NG:** 動作確認のために `console.log()` を追加し、そのまま残す。
- **OK:** 開発者が「デバッグログを追加して」と指示した場合のみ追加する。
- **削除ルール:** デバッグが完了したら、必ず削除する（または `if (process.env.NODE_ENV === 'development')` で囲む）。

---

## 10. コメントの追加ルール

**コメントは「なぜ（Why）」を説明するために使い、「何を（What）」は書かない。**

### 良いコメント（推奨）

```tsx
// microCMS の仕様により、公開日時は JST で返される
const publishedAt = new Date(data.publishedAt)

// Safari では backdrop-filter のサポートが不完全なため、フォールバック色を指定
className="bg-black/80 backdrop-blur-md supports-[backdrop-filter]:bg-black/50"
```

### 悪いコメント（非推奨）

```tsx
// データを取得する
const data = await fetchData()

// ボタンを表示する
<button>クリック</button>
```

### コメント追加の判断基準

- **追加すべき:** 複雑なロジック、ブラウザのバグ回避、外部 API の仕様など
- **不要:** 変数名や関数名で意図が明確な場合

---

## 11. 型安全性（TypeScript）の徹底

**`any` 型の使用は原則禁止。型が不明な場合は `unknown` を使用し、型ガードで絞り込むこと。**

### NG例

```tsx
const data: any = await fetchData()
return data.items // 型チェックが効かない
```

### OK例

```tsx
type ApiResponse = {
  items: Array<{ id: string; title: string }>
}

const data: ApiResponse = await fetchData()
return data.items // 型安全
```

### 型定義の配置

- **グローバル型:** `app/types/` ディレクトリに配置
- **ローカル型:** コンポーネントファイル内に定義（他で使わない場合）

---

## 12. AIの作業報告ルール

**作業完了後は、以下の形式で簡潔に報告すること。**

### 報告フォーマット

```
✅ 完了した作業
- Header コンポーネントを作成（app/components/layout/Header.tsx）
- スタイルは design.md のナビゲーションガイドに準拠

📝 変更内容
- ファイル追加: 1件
- 変更行数: +45行

🔍 確認事項
- レスポンシブ対応済み（sm, lg ブレークポイント）
- アクセシビリティ対応済み（キーボード操作、フォーカス表示）
```

### 報告のタイミング

- **即座に報告:** ファイル作成、大きな修正完了時
- **不要:** 軽微な修正（typo 修正など）

---

## 13. 並行作業の禁止

**複数の機能やコンポーネントを同時に作成・修正しないこと。1つずつ順番に完了させる。**

- **理由:** エラーの原因特定が困難になり、レビューも複雑化する。
- **原則:** 1つのコンポーネント → 動作確認 → 次のコンポーネント、の順で進める。

---

## 14. 破壊的変更の警告

**既存の動作に影響する変更（破壊的変更）を行う場合は、必ず事前に警告すること。**

### 破壊的変更の例

- API レスポンスの型定義の変更
- Props の型や名前の変更
- ファイルの移動や削除

### 警告フォーマット

```
⚠️ 破壊的変更の警告

この変更により、以下のファイルに影響が出る可能性があります:
- app/components/Card.tsx (Props の型が変更されます)
- app/(routes)/blog/page.tsx (import パスが変更されます)

続行しますか？
```

---